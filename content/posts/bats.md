---
title: Setup b√°sico do BATS
description: >
  Como configurar o BATS para come√ßar a ter testes automatizados para o seus programas Bash.
tags:
  - testes
date: 2025-06-13T15:00:00-03:00
cover:
  image: "img/bats-logo.png"
  alt: BATS logo
---


O objetivo principal desse artigo √© mostrar um setup bem b√°sico do BATS para que voc√™ possa facilmente testar seu c√≥digo bash.

N√£o desenvolveremos funcionalidade alguma, apenas mostrarei uma maneira conveniente de fazer este setup.

> ## AVISO!
>
> Se voc√™ j√° leu o artigo [Aprenda TDD no Bash](../tdd-bash) n√£o encontrar√° novidade alguma aqui!
>
> Escrevi esse artigo aqui pois percebi que o artigo original estava muito longo. Portanto resolvi quebr√°-lo em dois:
>
> 1. Setup do BATS
> 2. [Fluxo de _Test-Driven Development_](../hello-tdd)

## O que √© BATS?

[BATS](https://github.com/bats-core/bats-core) signfica Bash Automated Testing System. √â um _framework_ de testes para bash, que permite que verifiquemos se o nosso programa est√° se comportando da maneira que queremos.

 Estou sendo breve pois j√° quero partir pra a√ß√£o. Mas se voc√™ quiser, pode obter mais informa√ß√µes sobre o BATS na [documenta√ß√£o oficial](https://bats-core.readthedocs.io/).

### Instalando o BATS

A maioria das distribui√ß√µes GNU/Linux possuem um pacote chamado `bats` que voc√™ pode instalar usando o gerenciador de pacotes oficial.

Eu particularmente prefiro instalar via [Homebrew](https://brew.sh/), pois √© um m√©todo que funciona tanto pra GNU/Linux como pra MacOS.

```bash
brew install bats-core
```

Fique a vontade para instalar da maneira que voc√™ preferir.

## N√£o quero ler isso tudo! Me diz logo o que tenho que fazer!

Pula l√° pro [Resumo](#resumo) que voc√™ vai ver um checklist. Mas se quiser entender o que est√° fazendo, talvez seja melhor continuar lendo daqui mesmo...


## Setup b√°sico de um projeto com BATS

Antes de tudo, vamos preparar um diret√≥rio onde colocaremos o c√≥digo do nosso projeto:

```bash
mkdir try-bats
cd try-bats
```

Pra n√£o bagun√ßar o projeto misturando c√≥digo do nosso programa com o c√≥digo dos testes automatizados, vamos criar um diret√≥rio espec√≠fico para os testes:

```bash
# assumindo que j√° estamos no 'try-bats/'
mkdir test
```

Criaremos nosso primeiro teste para checar se estamos aptos a executar nosso script. Para isso criamos o arquivo `test/my_code_test.bats`.

**OBSERVA√á√ÉO**: o arquivo tem a extens√£o `.bats` mas o conte√∫do √© basicamente bash! O BATS n√£o √© uma "linguagem" nova que voc√™ tem que aprender. A √∫nica coisa diferente que voc√™ ver√° num arquivo `.bats` √© a declara√ß√£o dos testes nesse formato: `@test "nome do teste"`. Todo o resto √© apenas bash.

Aqui est√° o `test/my_code_test.bats`:

```bash
# eu prefiro colocar a descri√ß√£o em ingl√™s,
# fique a vontade pra colocar em portugu√™s.
@test "can run the script" {
  ./my_code.sh
}
```

√â isso mesmo! Nosso teste quer apenas verificar se conseguimos executar nosso programa, por isso est√° simplesmente chamando `./my_code.sh`! Vamos executar esse teste e ver o output:

```
$ bats test/my_code_test.bats 
my_code_test.bats
 ‚úó can run the script
   (in test file test/my_code_test.bats, line 2)
     `./my_code.sh' failed with status 127
   /home/meleu/src/try-bats/test/my_code_test.bats: line 2: ./my_code.sh: No such file or directory

1 test, 1 failure
```

üí• J√° come√ßamos com uma falha!

Observe que no meio daquela mensagem temos o motivo da falha: `./my_code.sh: No such file or directory`.

O arquivo n√£o existe. Pois ent√£o vamos cri√°-lo:

```bash
touch my_code.sh
```

E executar o teste novamente:

```
$ bats test/my_code_test.bats 
my_code_test.bats
 ‚úó can run the script
   (in test file test/my_code_test.bats, line 2)
     `./my_code.sh' failed with status 126
   /home/meleu/src/try-bats/test/my_code_test.bats: line 2: ./my_code.sh: Permission denied

1 test, 1 failure
```

Outra falha. Novamente com uma dica do que devemos fazer: `./my_code.sh: Permission denied`.

Se temos um `Permission denied`, s√≥ nos resta dar permiss√£o de execu√ß√£o pro arquivo e executar o teste novamente:

```
$ # dando permiss√£o de execu√ß√£o
$ chmod a+x my_code.sh 

$ # executando o teste
$ bats test/my_code_test.bats 
my_code_test.bats
 ‚úì can run the script

1 test, 0 failures
```

ü•≥üéâ Agora sim! Nosso primeiro teste passou!

T√° bom... Isso n√£o √© l√° grande coisa. Estamos apenas validando que um arquivo tem permiss√£o de execu√ß√£o. Essa parte foi s√≥ pra termos uma mini inje√ß√£o de dopamina ao ver um teste passando.

### Organizando os arquivos do projeto

J√° que criamos um diret√≥rio para os testes, vamos tamb√©m criar um diret√≥rio para o c√≥digo execut√°vel e colocar o arquivo l√°:

```bash
mkdir src
mv my_code.sh src/my_code.sh
```

Dessa forma teremos essa estrutura de diret√≥rios:

```
$ tree
.
‚îú‚îÄ‚îÄ src
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ my_code.sh
‚îî‚îÄ‚îÄ test
    ‚îî‚îÄ‚îÄ my_code_test.bats

2 directories, 2 files
```

Agora vamos executar nosso teste novamente:

```
$ bats test/my_code_test.bats 
my_code_test.bats
 ‚úó can run the script
   (in test file test/my_code_test.bats, line 2)
     `./my_code.sh' failed with status 127
   /home/meleu/src/try-bats/test/my_code_test.bats: line 2: ./my_code.sh: No such file or directory

1 test, 1 failure
```

Ooops! Nosso teste voltou a falhar por n√£o encontrar o arquivo!

Isso est√° acontecendo pois n√£o estamos especificando o caminho at√© o arquivo! Vamos resolver isso:

```bash
@test "can run the script" {
  ./src/my_code.sh
}
```

Executando o teste:

```
$ bats test/my_code_test.bats 
my_code_test.bats
 ‚úì can run the script

1 test, 0 failures
```

OK. Nosso arquivo foi encontrado e o teste passou. Mas ainda assim ficamos com aquela sensa√ß√£o de que essa solu√ß√£o n√£o parece muito robusta.

Vamos tentar por exemplo entrar no diret√≥rio do `test/` e executar o teste de l√°:

```
$ cd test/

$ bats my_code_test.bats 
my_code_test.bats
 ‚úó can run the script
   (in test file my_code_test.bats, line 2)
     `./src/my_code.sh' failed with status 127
   /home/meleu/src/try-bats/test/my_code_test.bats: line 2: ./src/my_code.sh: No such file or directory

1 test, 1 failure
```

O teste simplesmente n√£o encontrou nosso codigo, s√≥ por que mudamos de diret√≥rio... N√£o queremos um teste t√£o "fr√°gil" assim. Vamos resolver isso criando um `setup` pro nosso teste.

### Fazendo o `setup`

Em um arquivo BATS, a fun√ß√£o `setup` tem um significado especial: ela √© uma fun√ß√£o que ser√° executada antes de cada teste (se quiser mais detalhes veja a [documenta√ß√£o aqui](https://bats-core.readthedocs.io/en/stable/writing-tests.html#setup-and-teardown-pre-and-post-test-hooks)).

Vamos criar uma fun√ß√£o de `setup` para adicionar o caminho pro nosso execut√°vel direto no `PATH`. Dessa forma podemos executar o `my_code.sh` sem nos preocupar em especificar o caminho.

Nosso `test/my_code_test.bats` ent√£o fica assim:

```bash
setup() {
  PATH="${BATS_TEST_DIRNAME}/../src:${PATH}"
}

@test "can run the script" {
  my_code.sh
}
```

Ali no `setup` estamos nos aproveitando da vari√°vel `$BATS_TEST_DIRNAME`, que o BATS j√° deixa preenchida com o caminho pro diret√≥rio do arquivo de teste. A partir desse diret√≥rio vamos para `../src`, que √© onde est√° o nosso execut√°vel.

Observe que o teste tamb√©m est√° sendo feito com uma chamada direta ao `my_code.sh`, sem especificar o caminho. N√≥s podemos fazer isso pois o `setup` j√° deixou o `PATH` devidamente preparado.

Vamos conferir se isso realmente funciona:

```
$ bats my_code_test.bats 
my_code_test.bats
 ‚úì can run the script

1 test, 0 failures
```

Maravilha! Estamos no caminho certo!

### O que vimos at√© agora

- Criamos o diret√≥rio `try-bats` para come√ßar um novo projeto do zero.
- Colocamos nosso arquivo de teste no diret√≥rio `test/`.
- Nosso arquivo execut√°vel ficar√° em `src/`.
- Usamos o `setup` para atualizar o `PATH` com o caminho para o execut√°vel.
- Usamos a vari√°vel `$BATS_TEST_DIRNAME` pra pegar o caminho do diret√≥rio onde est√° nosso arquivo de teste.
- Nosso teste chama o arquivo execut√°vel usando apenas o nome do arquivo (sem precisar especificar o caminho completo)

S√≥ pra lembrar, no momento nosso `test/my_code_test.bats` est√° assim:

```bash
setup() {
  PATH="${BATS_TEST_DIRNAME}/../src:${PATH}"
}

@test "can run the script" {
  my_code.sh
}
```

E o nosso `src/my_code.sh` nada mais √© que um arquivo vazio com permiss√£o de execu√ß√£o.


## BATS helpers

O projeto BATS oferece helpers com algumas conveni√™ncias que podem nos ajudar bastante na escrita de testes.

No nosso projeto n√≥s queremos verificar se a sa√≠da do programa √© `Hello, World`. Fazemos isso criando **asser√ß√µes** sobre o que o programa gera como sa√≠da.

Para criar asser√ß√µes vamos precisar do helper `bats-assert`. Vamos usar tamb√©m o `bats-support` para que ele nos forne√ßa mensagens de erro/falha amig√°veis, dando mais clareza sobre onde nosso c√≥digo est√° quebrando.

Para utilizarmos estes helpers, vamos primeiro fazer com que nosso projeto fique em um reposit√≥rio git:

```bash
# assumindo que estamos no diret√≥rio 'hello-tdd'
git init
```

Para "instalar" BATS helpers vamos adicion√°-los como subm√≥dulos:

```bash
# bats-assert: respons√°vel pelas asser√ß√µes
git submodule add \
  https://github.com/bats-core/bats-assert.git \
  test/test_helper/bats-assert

# bats-support: respons√°vel por mensagems de falha mais amig√°veis
git submodule add \
  https://github.com/bats-core/bats-support.git \
  test/test_helper/bats-support

# bats-core: o bats propriamente dito (√∫til para usarmos em pipelines)
git submodule add \
  https://github.com/bats-core/bats-core.git \
  test/bats
```

Observe que estamos tamb√©m "instalando" como subm√≥dulo o pr√≥prio `bats-core`. Isso √© √∫til, por exemplo, para rodar testes diretamente numa pipeline de Integra√ß√£o Cont√≠nua (mas isso √© papo para um outro artigo).

No momento nossa estrutura de diret√≥rios est√° assim:

```
hello-tdd/
‚îú‚îÄ‚îÄ src/
‚îî‚îÄ‚îÄ test/
    ‚îú‚îÄ‚îÄ bats/        # üëà arquivos do bats-core aqui
    ‚îî‚îÄ‚îÄ test_helper/ # üëà bats-support e bats-assert aqui
```


### Fazendo asser√ß√µes

S√≥ para ilustrar vamos testar um programa que imprime `Hello, World` na tela.

Para j√° ir preparando o psicol√≥gico para o fluxo de _Test-Driven Development_, vamos come√ßar escrevendo nosso teste (antes mesmo do c√≥digo que vai imprimir `Hello, World`).

Primeiro vamos carregar os helpers no nosso `setup`, dessa forma:

```bash
setup() {
  load 'test_helper/bats-support/load'
  load 'test_helper/bats-assert/load'

  PATH="${BATS_TEST_DIRNAME}/../src:${PATH}"
}
```

Para testar tal programa precisamos fazer **asser√ß√µes** sobre sua sa√≠da. Nosso teste ficar√° assim:

```bash
# ... conte√∫do original do test/my_code_test.bats

@test "say Hello, World" {
  run my_code.sh # üëà note que estamos usando um `run` aqui!
  assert_output "Hello, World"
}
```

Nesse c√≥digo estamos usando o `run` para chamar o nosso programa. Isso nos traz v√°rias conveni√™ncias, como por exemplo automaticamente salvar a sa√≠da gerada pelo programa para que possamos verificar com o `assert_output`.

> Estou omitindo explica√ß√µes detalhadas do `run` e do `assert_output`. Se tiver d√∫vidas deixe ali nos coment√°rios.

Vamos executar o teste e ver o resultado:

```
$ bats test/my_code_test.bats 
my_code_test.bats
 ‚úì can run the script
 ‚úó say Hello, World
   (from function `assert_output' in file test/test_helper/bats-assert/src/assert_output.bash, line 194,
    in test file test/my_code_test.bats, line 16)
     `assert_output "Hello, World"' failed
   
   -- output differs --
   expected : Hello, World
   actual   :
   --
   

2 tests, 1 failure
```

O que √© bacana de usar o `assert_output` √© que ele diz claramente o que era esperado na sa√≠da e o que foi realmente impresso:

```
   expected : Hello, World
   actual   :
```

Esperamos `Hello, World` mas n√£o imprimimos coisa alguma. Isso j√° era de se esperar, afinal o nosso `my_code.sh` √© apenas um arquivo vazio com permiss√£o de execu√ß√£o.

Vamos resolver isso escrevendo o cl√°ssico hello-world em bash no `src/my_code.sh`:

```bash
#!/usr/bin/env bash

echo "Hello, World"
```

Executemos o teste novamente:

```
$ bats test/hello_test.bats 
hello_test.bats
 ‚úì can run the script
 ‚úì say Hello, World

2 tests, 0 failures
```

Woohool!!! ü•≥üéâ O teste passou! 

E aqui finalizamos nosso pontap√© inicial de como fazer um setup para come√ßar a usar o BATS para realizar testes automatizados em seus projetos bash.


## Resumo

Aqui est√° um resumo r√°pido e direto do que voc√™ deve fazer para ter um setup b√°sico de testes para seu projeto bash usando BATS.

### Checklilst

- [ ] Crie um diret√≥rio para o projeto
- [ ] Crie os diret√≥rios `test` e `src`
- [ ] Inicie um repo git
- [ ] Instale BATS
- [ ] Instale os BATS helpers

### Passo a passo

```bash
# diret√≥rio do projeto
mkdir my_project
cd my_project

# diret√≥rio dos testes e do c√≥digo de produ√ß√£o
mkdir test src

# iniciando um reposit√≥rio
git init

# bats-core: o bats propriamente dito (√∫til para usarmos em pipelines)
git submodule add \
  https://github.com/bats-core/bats-core.git \
  test/bats

# bats-assert: respons√°vel pelas asser√ß√µes
git submodule add \
  https://github.com/bats-core/bats-assert.git \
  test/test_helper/bats-assert

# bats-support: respons√°vel por mensagems de falha mais amig√°veis
git submodule add \
  https://github.com/bats-core/bats-support.git \
  test/test_helper/bats-support
```

Agora a estrutura de diret√≥rios do seu projeto estar√° assim:

```
.
‚îú‚îÄ‚îÄ src/
‚îî‚îÄ‚îÄ test/
    ‚îú‚îÄ‚îÄ bats/        # üëà arquivos do bats-core aqui
    ‚îî‚îÄ‚îÄ test_helper/ # üëà bats-support e bats-assert aqui
```

Para facilmente invocar o `my_code.sh` em qualquer um dos seus testes, coloque isso na fun√ß√£o `setup` do seu `test/my_code_test.bats`:

```bash
setup() {
  load 'test_helper/bats-support/load'
  load 'test_helper/bats-assert/load'

  PATH="${BATS_TEST_DIRNAME}/../src:${PATH}"
}

# Agora voc√™ consegue facilmente chamar seu c√≥digo
@test "can run the script" {
  run my_code.sh
  # veja como fazer asser√ß√µes no README de
  # https://github.com/bats-core/bats-assert
}
```


## Conclus√£o

Aprendemos como iniciar um projeto bash configurando o BATS como o framework de testes. Tamb√©m instalamos os helpers para podermos fazer asser√ß√µes facilmente.

No pr√≥ximo artigo come√ßaremos a usar a metodologia de Test-Driven Development para implementar novas funcionalidades no nosso "Hello, World".


## Refer√™ncias

- [BATS Tutorial](https://bats-core.readthedocs.io/en/stable/tutorial.html) - o tutorial oficial do BATS.